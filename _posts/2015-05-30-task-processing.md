---
layout: post
title: "浅谈多处理器任务调度算法"
tags: [算法]
---

上次去饿了么面试的时候，面试官提了一个问题关于多处理任务调度算法设计，题目是这样的：

1. 假设给了你一些任务，各个任务的执行时间**相同**，每个任务的可能又依赖其他一个或多个任务，**假设CPU个数不限**，求最优执行时间
2. 假设给了你一些任务，各个任务的执行时间**不同**，每个任务的可能又依赖其他一个或多个任务，**假设CPU个数不限**，求最优执行时间
3. 假设给了你一些任务，各个任务的执行时间**相同**，每个任务的可能又依赖其他一个或多个任务，**限制CPU个数**，求最优执行时间
4. 假设给了你一些任务，各个任务的执行时间**不同**，每个任务的可能又依赖其他一个或多个任务，**限制CPU个数**，求最优执行时间

关键词：贪心算法、启发式搜索、有向无环图

系统输入，第一列是任务，其他列是依赖项

	任务 依赖
	1 2
	2
	3 2
	4 1 2
	5 1 3
	6 1 2 3 4
	...

和面试官商量去掉了环路检测

做这道题首先要建立一个有向图，分析出个各个节点的入度和出度

入度为0的为开始点
出度为0的为终止点

1. 第一问答案就是有向图最长路径，由于CPU不限，其实只要找到有依赖的最长的一条路径（即关键路径）就是最优执行时间，其他的路径由于没有依赖可以并行处理
2. 第二问答案就是加权的有向图最长路径
3. 第三问有点难，懵了，大脑搜索一遍隐约有点印象，但是还是没有找到解法，放弃

课后作业关于第三问：

网上查了资料，和这个相关的有装箱问题和操作系统处理器调度

1. [装箱问题](http://machqr.blog.163.com/blog/static/5020129420091131249834/)

2. [操作系统处理器调度](http://www.jianshu.com/p/21b9824b699e)

这两个问题和我们这个题目还是有点区别:

1. 装箱问题常用算法有下次适应算法NF(Next Fit)近似算法，首次适应算法FF(First Fit)近似算法，降序首次适应算法FFD（First Fit Decreasing）近似算法，最佳适应算法BF(best Fit),降序最佳适应算法BFD(Best Fit Deceasing)，较好的算法是[降序首次适应算法](http://blog.csdn.net/lsh2216024/article/details/3596700),但是它要求的是任务之间没有依赖，以最小化箱子数目为最优目标，该算法不一定能找到最优解，只是相对较优，[网上实现的一个基于贪心算法的多CPU调度](http://www.xuebuyuan.com/1435659.html)
2. 操作系统处理器调度算法包括先到先服务，短作业优先调度，优先级调度，轮转法调度，多级队列调度，这里主要针对的是单CPU，以最小化等到时间为最优目标，同样没有考虑到任务之间的依赖，任务处理只能串行

仔细思考这个问题，发现还是和装箱问题有点相似的

开始挖坑
网上找到的和这个相关的论文，国内的翻了几篇，国外的还没翻，主要相关的三篇，还是最近发表的

1. 任务间相互依赖的并行作业调度算法研究（马丹）
2. 基于任务图的并行调度MEWFM算法（刘敏娜,解争龙,黄素萍）
3. 分布式系统中计算作业流的均衡调度算法（汤小春,李洪华）

刘敏娜和汤小春的论文有详细的处理调度过程，这两种算法本质上，还是分层算法，马丹的博士论文中有详细的关于任务间相互依赖的并行作业调度算法总结。


算法的处理流程可以概括为
任务图分层-》任务分组

任务图分层：把任务图中的所有任务按照某种优先级的高低顺序排成调度表
任务分组：从调度表中依次取出各个任务，将任务分配到使它的完成时间最早的处理器

根据根据分层和分组算法的不同产生很多种算法，主要的分层算法根据当前节点被后面的依赖的多少赋予特定的优先级，对 DAG 任务图分层之后形成多个任务层,在任务层内部,独立的多个任务通过一定的调度算法（降序首次适应算法）实现并行执行。刘敏娜提出了一种优化的最小分组方差算法

<img src="/blog/public/images/posts/code/dag.png" >

更多坑稍后再填，挖不下去了，这个算法真不是一下子能说清的，哪来的最优？